#!/usr/bin/make -f
# Sample debian/rules that uses debhelper. 
# GNU copyright 1997 by Joey Hess.
#
# This version is for a hypothetical package that builds an
# architecture-dependant package, as well as an architecture-independent
# package.

# Uncomment this to turn on verbose mode. 
#export DH_VERBOSE=1

# This is the debhelper compatability version to use.
export DH_COMPAT=2

configure: configure-stamp
configure-stamp:
	dh_testdir

	if [ configure.in -nt configure ]; then autoconf; fi
#	mkdir -p unknown
	./configure --prefix=/usr --mandir=\$${prefix}/share/man --infodir=\$${prefix}/share/info
#	rmdir unknown

	touch configure-stamp

build: build-stamp
build-stamp: configure-stamp
	dh_testdir

	# Add here commands to compile the package.
	$(MAKE) OFLAG=-O4

#	for f in info/gcl-si.info-*.gz; do zcat $$f > `echo $$f | sed -e 's/.gz$$//'`; done

	touch build-stamp

clean:
	dh_testdir
	dh_testroot
	rm -f build-stamp configure-stamp

	-$(MAKE) clean
#	-rm -f config.cache config.status gmp/config.cache gmp/config.status \
#	       xbin/gcl config.log unixport/raw_gcl unixport/saved_gcl
#	rm -f gcl-tk/demos/index.lsp
	#bash debian/clean

	dh_clean

install: DH_OPTIONS=
install: build
	dh_testdir
	dh_testroot
	dh_clean -k
	dh_installdirs

	$(MAKE) install-command INSTALL_LIB_DIR=/usr/lib/gcl prefix=debian/gcl/usr
	chmod 755 debian/gcl/usr/bin/gcl
	install -m644 cmpnew/collectfn.o debian/gcl/usr/lib/gcl/cmpnew/
	install -m644 elisp/*.el debian/gcl/usr/lib/gcl/elisp/
#	install -m644 gcl-tk/decode.tcl gcl-tk/gcl.tcl gcl-tk/tkl.o gcl-tk/tinfo.o debian/gcl/usr/lib/gcl/gcl-tk/
#	install -m755 -s gcl-tk/gcltkaux debian/gcl/usr/lib/gcl/gcl-tk/
#	sed -e 's:GCL_TK_DIR=.*:GCL_TK_DIR=/usr/lib/gcl/gcl-tk:' gcl-tk/gcltksrv > debian/gcl/usr/lib/gcl/gcltksrv
#	chmod 755 debian/gcl/usr/lib/gcl/gcltksrv
#	install -m644 gcl-tk/demos/*.lsp gcl-tk/demos/*.lisp gcl-tk/demos/*.o gcl-tk/demos/*.tcl debian/gcl/usr/lib/gcl/gcl-tk/demos/
	rm -f debian/gcl/usr/lib/gcl/gcl-tk/demos/index.lsp
	install -m644 lsp/gprof.lsp lsp/profile.lsp lsp/info.o debian/gcl/usr/lib/gcl/lsp/
	install -m644 misc/*.{c,ch,lsp} debian/gcl/usr/lib/gcl/misc/
	# Do not strip!
	install -m755 unixport/saved_gcl debian/gcl/usr/lib/gcl/unixport/
#	ln -s ../lib/gcl/unixport/saved_gcl debian/gcl/usr/bin/gcl.exe

	install -m644 info/*.html debian/gcl/usr/share/doc/gcl/html

# Build architecture-independent files here.
# Pass -i to all debhelper commands in this target to reduce clutter.
binary-indep: build install
	dh_testdir -i
	dh_testroot -i
	dh_installdocs -i
	dh_installinfo -i
	perl -pi -e 's/--quiet .*gcl-si/--section "GNU Common Lisp" "GNU Common Lisp" --description="GNU Common Lisp System Internals." $$&/; s/--quiet .*gcl-tk/--section "GNU Common Lisp" "GNU Common Lisp" --description="GNU Common Lisp Tk Manual." $$&/'  debian/gcl-doc.postinst.debhelper
	dh_installchangelogs ChangeLog -i
	dh_link -i
	dh_compress -i
	dh_fixperms -i
	dh_installdeb -i
	dh_gencontrol -i
	dh_md5sums -i
	dh_builddeb -i

# Build architecture-dependent files here.
binary-arch: build install
	dh_testdir -a
	dh_testroot -a
	dh_installdocs -a
	dh_installmanpages -a
	dh_installchangelogs ChangeLog -a
	dh_strip -a
	dh_link -a
	dh_compress -a
	dh_fixperms -a
	dh_installdeb -a
	dpkg-shlibdeps debian/gcl/usr/lib/gcl/unixport/saved_gcl -Tdebian/gcl.substvars
	#dpkg-shlibdeps debian/gcl/usr/lib/gcl/unixport/saved_gcl -dSuggests debian/gcl/usr/lib/gcl/gcl-tk/gcltkaux
	dh_gencontrol -a
	dh_md5sums -a
	dh_builddeb -a

binary: binary-indep binary-arch
.PHONY: build clean binary-indep binary-arch binary install configure

# vim:noet:nosta:nolist:
